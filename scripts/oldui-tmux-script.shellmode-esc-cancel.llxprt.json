{
  "tmux": {
    "cols": 120,
    "rows": 35,
    "historyLimit": 50000,
    "scrollbackLines": 6000,
    "initialWaitMs": 6000
  },
  "yolo": true,
  "startCommand": [
    "env",
    "LLXPRT_CODE_SYSTEM_SETTINGS_PATH=scripts/oldui-system-settings.use-pty.json",
    "node",
    "scripts/start.js",
    "--profile-load",
    "synthetic",
    "--yolo"
  ],
  "steps": [
    {
      "type": "waitFor",
      "scope": "screen",
      "contains": "Type your message",
      "timeoutMs": 30000
    },

    { "type": "key", "key": "!" },
    {
      "type": "waitFor",
      "scope": "screen",
      "contains": "shell mode enabled",
      "timeoutMs": 10000
    },

    {
      "type": "line",
      "text": "node -e \"let i=0; setInterval(()=>{console.log('TICK:'+ (++i));},20);\"",
      "submitKeys": ["Enter"]
    },
    {
      "type": "waitFor",
      "scope": "scrollback",
      "contains": "TICK:",
      "timeoutMs": 15000
    },

    { "type": "line", "text": "\u001b[27u", "submitKeys": [], "postTypeMs": 0 },
    {
      "type": "waitFor",
      "scope": "screen",
      "contains": "Request cancelled.",
      "timeoutMs": 10000
    },
    {
      "type": "waitForNot",
      "scope": "screen",
      "contains": "esc to cancel",
      "timeoutMs": 10000
    },
    {
      "type": "waitFor",
      "scope": "scrollback",
      "contains": "Command was cancelled.",
      "timeoutMs": 10000
    },

    { "type": "key", "key": "!" },
    {
      "type": "waitFor",
      "scope": "screen",
      "contains": "shell mode enabled",
      "timeoutMs": 10000
    },
    { "type": "line", "text": "echo AFTER_CANCEL", "submitKeys": ["Enter"] },
    {
      "type": "waitFor",
      "scope": "scrollback",
      "contains": "AFTER_CANCEL",
      "timeoutMs": 10000
    },

    { "type": "line", "text": "/quit", "submitKeys": ["Escape", "Enter"] },
    { "type": "waitForExit", "timeoutMs": 30000 }
  ]
}
