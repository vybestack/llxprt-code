# Batch 01 Audit

## Intent
Reimplement upstream `b8df8b2a` to wire ASK_USER policy decisions through the message bus so tools can request/receive confirmation results, with LLxprt-specific adaptation (google web fetch).

## Claimed Action
- Updated `getMessageBusDecision()` in `packages/core/src/tools/tools.ts` to return `'ALLOW' | 'DENY' | 'ASK_USER'` and publish/subscribe via message bus.
- Added message bus integration to `google-web-fetch.ts` `shouldConfirmExecute()`.
- Added `unsubscribe()` to `MessageBus` for handler cleanup.
- Noted upstream files (`web-fetch.ts`, `web-fetch.test.ts`, `message-bus-integration.test.ts`) do not exist in LLxprt.

## Code Evidence
- `packages/core/src/tools/tools.ts:103` shows `getMessageBusDecision()` returning `'ALLOW' | 'DENY' | 'ASK_USER'` and using message bus publish/subscribe for confirmation.
- `packages/core/src/tools/google-web-fetch.ts:222` shows `shouldConfirmExecute()` calling `getMessageBusDecision()` and honoring ALLOW/DENY/ASK_USER before legacy confirmation UI.
- `packages/core/src/confirmation-bus/message-bus.ts:70` shows new `unsubscribe()` helper to remove handlers.
- `project-plans/20260104gmerge/AUDIT.md:23` records Batch 01 as REIMPLEMENTED with local commit `b46177ec0` and notes NO_OP for missing upstream files.
- `project-plans/20260104gmerge/NOTES.md:61` documents the Batch 01 implementation details and modified files.

## Gaps/Mismatches
- Upstream-specific files (`web-fetch.ts`, `web-fetch.test.ts`, `message-bus-integration.test.ts`) do not exist in LLxprt; implementation was applied only to `google-web-fetch.ts` per notes. This is an expected divergence, not a missing change.

## Verdict
real
