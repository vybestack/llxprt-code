# Batch 47 Audit

## Planned
- Upstream `847c6e7f` (refactor(core): extract ChatCompressionService from GeminiClient) was scheduled as a PICK in `project-plans/20260104gmerge/PLAN.md` (Batch 47).

## Reported
- `project-plans/20260104gmerge/PROGRESS.md` marks Batch 47 as “SKIP-REIMPLEMENT (different compression architecture)”.
- `project-plans/20260104gmerge/NOTES.md` documents the decision to skip the upstream refactor because LLxprt already has compression logic integrated in `client.ts`/`geminiChat.ts` with HistoryService-based token handling and no telemetry helpers like `logChatCompression()`.

## Actual (evidence)
- LLxprt’s compression flow is implemented directly inside `packages/core/src/core/client.ts` via `tryCompressChat()` (lines ~1703-1884), including token threshold checks, compression split point logic, and direct compression calls using the existing chat instance.
- `packages/core/src/core/geminiChat.ts` implements compression orchestration (`shouldCompress`, `ensureCompressionBeforeSend`, `performCompression`) and history locking (lines ~1595-1886), indicating compression remains embedded in GeminiChat rather than extracted into a standalone service.
- No `ChatCompressionService` exists in `packages/core/src/services` (repository search for `ChatCompressionService` returns no matches).

## Gaps
- The upstream refactor introducing `ChatCompressionService` and associated tests/utilities was not applied.
- Upstream structural changes (new service class, `getInitialChatHistory()` utility, telemetry hooks) are absent; LLxprt continues to use its integrated compression path.

## Confidence
- High. The compression logic is clearly present in `client.ts` and `geminiChat.ts`, and the absence of any `ChatCompressionService` implementation confirms the upstream refactor did not land.
