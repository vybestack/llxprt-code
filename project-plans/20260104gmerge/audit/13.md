# Batch 13 Audit (dcf362bc)

## Intent
- Inline tree-sitter WASM for shell parsing and add runtime fallback for the shell tool (upstream `dcf362bc`).

## Claimed Action
- ~~PROGRESS.md marks Batch 13 as QUICK/SKIP for `dcf362bc`, deferred due to complex build system changes~~
- **UPDATE (2026-01-07)**: Now IMPLEMENTED with tree-sitter WASM shell parser (commit 36e269612)

## Code Evidence
- `packages/core/src/utils/shell-parser.ts` - Tree-sitter wrapper module with:
  - `initializeParser()` - Loads WASM binary and initializes parser
  - `parseShellCommand()` - Returns AST from shell command string
  - `extractCommandNames()` - Extracts command names from AST
  - `hasCommandSubstitution()` - Detects $(), ``, <(), >() constructs
  - `splitCommandsWithTree()` - Splits commands respecting &&, ||, ;, |
- `packages/core/src/utils/shell-utils.ts` - Integrated tree-sitter with regex fallback:
  - `splitCommands()` tries tree-sitter first, falls back to `splitCommandsRegex()`
  - `getCommandRoots()` tries tree-sitter first, falls back to `getCommandRootsRegex()`
  - `detectCommandSubstitution()` tries tree-sitter first, falls back to `detectCommandSubstitutionRegex()`
- `packages/core/src/tools/shell.ts:8` - Imports and initializes parser on module load
- `esbuild.config.js` - WASM plugin for binary embedding
- Dependencies: `web-tree-sitter: ^0.25.10`, `tree-sitter-bash: ^0.25.0`

## Gaps/Mismatches
- None - implementation complete with graceful fallback

## Verdict
IMPLEMENTED
