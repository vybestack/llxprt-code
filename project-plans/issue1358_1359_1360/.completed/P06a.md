# P06a Verification: Token Sanitization & Merge Stubs

**Plan ID:** PLAN-20250214-CREDPROXY.P06a
**Date:** 2025-02-16
**Result:** [OK] PASS

---

## Files Reviewed

1. `packages/core/src/auth/token-sanitization.ts` (22 lines)
2. `packages/core/src/auth/token-merge.ts` (22 lines)

## Checklist Results

| # | Check | Result |
|---|-------|--------|
| 1 | Both files exist | [OK] Both found at expected paths |
| 2 | `token-sanitization.ts` exports | [OK] Exports `SanitizedOAuthToken` type and `sanitizeTokenForProxy` function |
| 3 | `token-merge.ts` exports | [OK] Exports `OAuthTokenWithExtras` type and `mergeRefreshedToken` function |
| 4 | Import path convention | [OK] Both import `OAuthToken` from `./types.js` |
| 5 | Plan markers present | [OK] Both have `@plan PLAN-20250214-CREDPROXY.P06` |
| 6 | All methods throw NotYetImplemented | [OK] Both throw `new Error('NotYetImplemented')` |
| 7 | No TODO/FIXME/HACK comments | [OK] Grep found zero matches in both files |
| 8 | `npm run typecheck` passes | [OK] All 4 workspaces clean (core, root, a2a-server, test-utils) |
| 9 | No duplicate/parallel files | [OK] Glob `**/token-sanitiz*` → 1 file; `**/token-merge*` → 1 file |

## Detail

### `token-sanitization.ts`
- Type `SanitizedOAuthToken` = `Omit<OAuthToken, 'refresh_token'> & Record<string, unknown>` — correctly strips refresh_token from the type
- Function `sanitizeTokenForProxy(_token: OAuthToken): SanitizedOAuthToken` — parameter prefixed with `_` per convention for stubs
- References `@requirement R10.1, R10.2, R10.3` and `@pseudocode analysis/pseudocode/002-token-sanitization-merge.md`

### `token-merge.ts`
- Type `OAuthTokenWithExtras` = `OAuthToken & Record<string, unknown>` — extends OAuthToken with arbitrary extra fields
- Function `mergeRefreshedToken(_current: OAuthTokenWithExtras, _next: Partial<OAuthTokenWithExtras>): OAuthTokenWithExtras` — correct signature for partial merge
- References `@requirement R12.1, R12.2, R12.3, R12.4, R12.5` and `@pseudocode analysis/pseudocode/002-token-sanitization-merge.md`
