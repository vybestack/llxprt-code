# Phase 0.5: Preflight Verification

## Phase ID
`PLAN-20260211-SANDBOX1036.P0.5`

## Prerequisites
- None (first phase â€” Phase 0.5 preflight)

## Purpose
Verify all assumptions before writing any code. Confirm dependencies, types,
file paths, and existing patterns match what the plan expects.

## Verification Tasks

### 1. File Existence
- [ ] `packages/cli/src/utils/sandbox.ts` exists
- [ ] `packages/cli/src/utils/sandbox.test.ts` exists
- [ ] `packages/cli/src/config/sandboxConfig.ts` exists

### 2. Type Verification
Verify `SandboxConfig` type in `packages/core/src/config/config.ts`:
```bash
grep -A 5 "interface SandboxConfig" packages/core/src/config/config.ts
```
Expected: `command: 'docker' | 'podman' | 'sandbox-exec'` and `image: string`

### 3. Stale Error Message Location
```bash
grep -n "gemini-cli-dev@google.com" packages/cli/src/utils/sandbox.ts
```
Expected: One match near line 526

### 4. SSH Agent Section Location
```bash
grep -n "shouldEnableSshAgent\|SSH_AUTH_SOCK\|ssh-agent" packages/cli/src/utils/sandbox.ts
```
Expected: SSH agent logic around lines 670-710

### 5. Existing Exports
```bash
grep "^export" packages/cli/src/utils/sandbox.ts
```
Expected: `getPassthroughEnvVars`, `buildSandboxEnvArgs`, `start_sandbox`
are exported. New helper functions must also be exported for testability.

### 6. Test Framework
```bash
head -10 packages/cli/src/utils/sandbox.test.ts
```
Expected: Uses `vitest` (describe, it, expect, beforeEach)

### 7. Import Availability
Verify these are already imported in sandbox.ts:
- `os` from `node:os` (for `os.platform()`, `os.homedir()`)
- `fs` from `node:fs` (for `fs.existsSync()`)
- `path` from `node:path`
- `spawn` from `node:child_process`
- `FatalSandboxError` from `@vybestack/llxprt-code-core`
- `execAsync` (promisified exec)

```bash
grep -E "^import" packages/cli/src/utils/sandbox.ts | head -20
```

### 8. Dual-HOME Pattern
Verify existing dual-mount pattern for user settings:
```bash
grep -A 5 "userSettingsDirInSandbox" packages/cli/src/utils/sandbox.ts
```
Expected: Mounts at both `/home/node/.llxprt` and host home path

### 9. Build System
```bash
npm run typecheck --workspace=packages/cli 2>&1 | tail -5
npm run test --workspace=packages/cli -- --run sandbox.test 2>&1 | tail -10
```
Expected: Both pass

## Blocking Issues
List any issues discovered that require plan modification before proceeding.

## Verification Gate
ALL checks above must pass before any implementation phase begins.
