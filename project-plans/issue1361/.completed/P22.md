# Phase 22 Completed: Session Management TDD

## Phase ID
`PLAN-20260211-SESSIONRECORDING.P22`

## Completed
2026-02-11

## Files Created
- `packages/core/src/recording/sessionManagement.test.ts` — 21 behavioral and property-based tests for listSessions and deleteSession

## Test Summary
- **Total tests:** 21
- **Behavioral tests:** 14
- **Property-based tests:** 7 (33.3% of total)
- **All passing:** [OK]

## Behavioral Tests (14)
1. listSessions returns session data for all matching sessions
2. listSessions returns sessions sorted newest-first by mtime
3. listSessions returns sessions with correct metadata fields
4. listSessions returns empty sessions array when no sessions exist
5. listSessions wraps discovery result in ListSessionsResult with sessions property
6. deleteSession by exact ID removes file from disk
7. deleteSession by unique prefix
8. deleteSession by numeric index (1 = newest)
9. Delete removes .lock sidecar alongside session file
10. Delete locked session fails (live process lock)
11. Delete stale-locked session succeeds (dead PID)
12. Delete non-existent session returns error
13. Delete from empty directory returns error
14. Delete result includes the deleted session ID

## Property-Based Tests (7)
15. listSessions returns correct count for any N sessions (fc.integer 0-8)
16. Delete always removes both .jsonl and .lock (fc.boolean for lock presence)
17. listSessions always returns sessions sorted newest-first (fc.integer 2-6)
18. deleteSession by any valid numeric index removes correct session (fc.integer 1-5)
19. Any UUID session can be listed then deleted (fc.uuid)
20. Every listed session has a positive file size (fc.integer 1-5)
21. Delete non-existent session always fails for any non-matching ref (fc.stringMatching)

## Requirements Covered
- REQ-MGT-001: List sessions with correct metadata, sorted newest-first
- REQ-MGT-002: Delete session by ID/prefix/index, removes files from disk
- REQ-MGT-003: Refuse to delete locked session (live process)
- REQ-MGT-004: Delete stale-locked session succeeds

## Verification
```
npm run typecheck — PASS
vitest run sessionManagement.test.ts — 21 passed, 0 failed
No mock theater (vi.mock, toHaveBeenCalled) — PASS
No reverse testing (NotYetImplemented) — PASS
```
