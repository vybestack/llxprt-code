# P09 — Strategy Factory TDD

**Status:** [OK] Complete
**Date:** 2026-02-11

## Summary

Created `packages/core/src/core/compression/compressionStrategyFactory.test.ts` with
behavioral tests for the factory functions `getCompressionStrategy` and
`parseCompressionStrategyName`.

## Files Created

- `packages/core/src/core/compression/compressionStrategyFactory.test.ts`

## Files Modified

- (none)

## Tests Added

9 test cases:

1. `getCompressionStrategy('middle-out')` returns `MiddleOutStrategy` instance
2. `getCompressionStrategy('top-down-truncation')` returns `TopDownTruncationStrategy` instance
3. Middle-out instance has correct `name` and `requiresLLM` values
4. Top-down-truncation instance has correct `name` and `requiresLLM` values
5. Factory returns fresh instances (not singletons)
6. `parseCompressionStrategyName('middle-out')` returns `'middle-out'`
7. `parseCompressionStrategyName('top-down-truncation')` returns `'top-down-truncation'`
8. `parseCompressionStrategyName('nonexistent')` throws `UnknownStrategyError`
9. Error message includes the unknown name
10. Interface contract loop: each `COMPRESSION_STRATEGIES` entry has matching name, boolean `requiresLLM`, function `compress`

## Requirements Covered

| Requirement | Description |
|---|---|
| REQ-CS-001.2 | Factory maps strategy names to CompressionStrategy instances |
| REQ-CS-001.3 | Unknown strategy names throw actionable errors |

## Verification

```
$ npx vitest run packages/core/src/core/compression/compressionStrategyFactory.test.ts
FAIL — Cannot find module './compressionStrategyFactory.js'
```

Tests fail with module-not-found (expected — implementation is Phase 10).
No syntax errors, no `toHaveBeenCalled`, no mock theater.
